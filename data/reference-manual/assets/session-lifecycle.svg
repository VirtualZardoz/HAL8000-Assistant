<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1050">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="800" y="35" font-family="system-ui, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Session Lifecycle (Circular Flow)</text>

  <!-- Top Row: Boot → Load BIOS → Load State → Note Session -->

  <!-- Boot Start -->
  <ellipse cx="120" cy="120" rx="80" ry="45" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
  <text x="120" y="115" font-family="system-ui, sans-serif" font-size="15" font-weight="bold" fill="#1a1a1a" text-anchor="middle">New Instance</text>
  <text x="120" y="133" font-family="system-ui, sans-serif" font-size="13" fill="#1a1a1a" text-anchor="middle">Boot</text>

  <line x1="200" y1="120" x2="270" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Load BIOS -->
  <rect x="270" y="80" width="200" height="80" fill="#fff3e0" stroke="#e65100" stroke-width="2" rx="5"/>
  <text x="370" y="108" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Load BIOS</text>
  <text x="370" y="128" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Read CLAUDE.md</text>
  <text x="370" y="145" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">Understand architecture</text>

  <line x1="470" y1="120" x2="540" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Load State -->
  <rect x="540" y="80" width="200" height="80" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="640" y="108" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Load State</text>
  <text x="640" y="128" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Read state.json</text>
  <text x="640" y="145" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">Extract session pointer</text>

  <line x1="740" y1="120" x2="810" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Note Session -->
  <rect x="810" y="80" width="200" height="80" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="5"/>
  <text x="910" y="108" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Note Session</text>
  <text x="910" y="128" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Session pointer noted</text>
  <text x="910" y="145" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">(Not loaded yet)</text>

  <!-- Down to decision -->
  <line x1="910" y1="160" x2="910" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Mid Row: User Choice -->

  <!-- User Choice Diamond -->
  <polygon points="910,250 1000,320 910,390 820,320" fill="#fff9c4" stroke="#f57f17" stroke-width="2"/>
  <text x="910" y="313" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">User</text>
  <text x="910" y="332" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Choice?</text>

  <!-- Resume path (left) -->
  <line x1="820" y1="320" x2="700" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="750" y="312" font-family="system-ui, sans-serif" font-size="12" fill="#666">Resume</text>

  <rect x="520" y="280" width="180" height="80" fill="#e1f5fe" stroke="#0277bd" stroke-width="2" rx="5"/>
  <text x="610" y="305" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Load Session File</text>
  <text x="610" y="325" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Read previous context</text>
  <text x="610" y="343" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">RAM += session content</text>

  <!-- Start Fresh path (right) -->
  <line x1="1000" y1="320" x2="1120" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="1050" y="312" font-family="system-ui, sans-serif" font-size="12" fill="#666">Start Fresh</text>

  <rect x="1120" y="280" width="180" height="80" fill="#e1f5fe" stroke="#0277bd" stroke-width="2" rx="5"/>
  <text x="1210" y="305" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Begin New Work</text>
  <text x="1210" y="325" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Clean RAM state</text>
  <text x="1210" y="343" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">No session loaded</text>

  <!-- Both paths converge -->
  <line x1="610" y1="360" x2="610" y2="480" stroke="#333" stroke-width="2"/>
  <line x1="610" y1="480" x2="910" y2="480" stroke="#333" stroke-width="2"/>
  <line x1="1210" y1="360" x2="1210" y2="480" stroke="#333" stroke-width="2"/>
  <line x1="1210" y1="480" x2="910" y2="480" stroke="#333" stroke-width="2"/>
  <line x1="910" y1="480" x2="910" y2="540" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Mid-Bottom Row: Work → Monitor RAM -->

  <!-- Work in Session -->
  <rect x="810" y="540" width="200" height="100" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
  <text x="910" y="570" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Work in Session</text>
  <text x="910" y="592" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Execute operations</text>
  <text x="910" y="612" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Load files, process data</text>
  <text x="910" y="630" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">RAM usage increasing</text>

  <line x1="810" y1="590" x2="680" y2="590" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Monitor RAM -->
  <rect x="520" y="540" width="160" height="100" fill="#fff3e0" stroke="#ef6c00" stroke-width="2" rx="5"/>
  <text x="600" y="570" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Monitor RAM</text>
  <text x="600" y="592" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Check RAM_ZONE</text>
  <text x="600" y="612" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">SAFE → continue</text>
  <text x="600" y="630" font-family="Monaco, monospace" font-size="11" fill="#ef6c00" text-anchor="middle">CAUTION → checkpoint</text>

  <line x1="520" y1="590" x2="390" y2="590" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Bottom Row: Session End → Update Files → RAM Wipe -->

  <!-- Session End -->
  <rect x="230" y="540" width="160" height="100" fill="#ffebee" stroke="#c62828" stroke-width="2" rx="5"/>
  <text x="310" y="570" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#c62828" text-anchor="middle">/HAL-session-end</text>
  <text x="310" y="592" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Capture context</text>
  <text x="310" y="612" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Create session file</text>
  <text x="310" y="630" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">Update state/log</text>

  <line x1="310" y1="640" x2="310" y2="710" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Update Files -->
  <rect x="220" y="710" width="180" height="110" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="5"/>
  <text x="310" y="740" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Update Files</text>
  <text x="310" y="762" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Write session file</text>
  <text x="310" y="782" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Overwrite state.json</text>
  <text x="310" y="802" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Append to system.log</text>

  <line x1="310" y1="820" x2="310" y2="880" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- RAM Wipe -->
  <rect x="220" y="880" width="180" height="90" fill="#ffebee" stroke="#c62828" stroke-width="3" rx="5"/>
  <text x="310" y="910" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#c62828" text-anchor="middle">RAM WIPE</text>
  <text x="310" y="932" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">Context cleared</text>
  <text x="310" y="952" font-family="Monaco, monospace" font-size="11" fill="#666" text-anchor="middle">Ready for new instance</text>

  <!-- Loop back to Boot -->
  <line x1="220" y1="925" x2="120" y2="925" stroke="#333" stroke-width="3"/>
  <line x1="120" y1="925" x2="120" y2="165" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="160" y="545" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1976d2" transform="rotate(-90 160 545)">RESTART CYCLE</text>

  <!-- Legend -->
  <rect x="1150" y="600" width="380" height="300" fill="#f5f5f5" stroke="#999" stroke-width="2" rx="5"/>
  <text x="1340" y="630" font-family="system-ui, sans-serif" font-size="15" font-weight="bold" fill="#1a1a1a" text-anchor="middle">Session Lifecycle Key Points</text>

  <text x="1170" y="660" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#1976d2">Boot Sequence:</text>
  <text x="1170" y="680" font-family="system-ui, sans-serif" font-size="11" fill="#333">Load BIOS → Load state → Note session pointer</text>

  <text x="1170" y="710" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#f57f17">User Choice:</text>
  <text x="1170" y="730" font-family="system-ui, sans-serif" font-size="11" fill="#333">Resume (load session) OR Start Fresh</text>

  <text x="1170" y="760" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#ef6c00">RAM Monitoring:</text>
  <text x="1170" y="780" font-family="system-ui, sans-serif" font-size="11" fill="#333">SAFE → continue | CAUTION → checkpoint</text>

  <text x="1170" y="810" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#c62828">Session End:</text>
  <text x="1170" y="830" font-family="system-ui, sans-serif" font-size="11" fill="#333">Save context → Update files → RAM wipe</text>

  <text x="1170" y="860" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#2e7d32">Circular Flow:</text>
  <text x="1170" y="880" font-family="system-ui, sans-serif" font-size="11" fill="#333">After RAM wipe → Restart at Boot (new instance)</text>
</svg>
