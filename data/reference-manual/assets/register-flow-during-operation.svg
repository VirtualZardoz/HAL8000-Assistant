<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 500">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
  </defs>

  <!-- Row 1: Top row - 4 stages -->

  <!-- Stage 1: User Command -->
  <rect x="20" y="20" width="200" height="100" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="120" y="50" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">User Command</text>
  <text x="120" y="75" font-family="Monaco, monospace" font-size="12" fill="#333" text-anchor="middle">'Read .claude/state.json'</text>

  <!-- Arrow 1->2 -->
  <line x1="220" y1="70" x2="270" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 2: Decode Phase -->
  <rect x="270" y="20" width="250" height="100" fill="#fff3e0" stroke="#e65100" stroke-width="2" rx="5"/>
  <text x="395" y="45" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">DECODE PHASE</text>
  <text x="395" y="65" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">IR ← 'Read .claude/state.json'</text>
  <text x="395" y="82" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">USER_INTENT ← 'Load state'</text>
  <text x="395" y="99" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">MAR ← file_path</text>

  <!-- Arrow 2->3 -->
  <line x1="520" y1="70" x2="570" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 3: Execute Phase -->
  <rect x="570" y="20" width="250" height="100" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="695" y="45" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">EXECUTE PHASE</text>
  <text x="695" y="65" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Open file handle</text>
  <text x="695" y="82" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">TEMP_REGISTER ← handle</text>
  <text x="695" y="99" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Prepare for read</text>

  <!-- Arrow 3->4 -->
  <line x1="820" y1="70" x2="870" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 4: Read Operation -->
  <rect x="870" y="20" width="250" height="100" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
  <text x="995" y="40" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">READ OPERATION</text>
  <text x="995" y="58" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">MDR ← contents: 842 tokens</text>
  <text x="995" y="75" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">ACCUMULATOR ← parsed_data</text>
  <text x="995" y="92" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">RAM_USAGE += 842</text>
  <text x="995" y="109" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Close handle</text>

  <!-- Arrow down from Read to Update -->
  <line x1="995" y1="120" x2="995" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="995" y1="160" x2="395" y2="160" stroke="#333" stroke-width="2"/>
  <line x1="395" y1="160" x2="395" y2="200" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Row 2: Bottom row - 3 stages -->

  <!-- Stage 5: Update Manifest -->
  <rect x="270" y="200" width="250" height="100" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="5"/>
  <text x="395" y="225" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">UPDATE MANIFEST</text>
  <text x="395" y="245" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">CONTEXT_MANIFEST ← append</text>
  <text x="395" y="262" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">{ path: '.claude/state.json',</text>
  <text x="395" y="279" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">tokens: 842, timestamp: now }</text>

  <!-- Arrow 5->6 -->
  <line x1="520" y1="250" x2="570" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 6: Recalculate Zone -->
  <rect x="570" y="200" width="250" height="100" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
  <text x="695" y="225" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">RECALCULATE ZONE</text>
  <text x="695" y="245" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">RAM_ZONE ← calculate_zone</text>
  <text x="695" y="262" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">(RAM_USAGE / 200000)</text>
  <text x="695" y="279" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">Example: 30% → 'SAFE (30%)'</text>

  <!-- Arrow 6->7 -->
  <line x1="820" y1="250" x2="870" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 7: Complete -->
  <rect x="870" y="200" width="250" height="100" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="5"/>
  <text x="995" y="220" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#1a1a1a" text-anchor="middle">COMPLETE</text>
  <text x="995" y="240" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">OPERATION_RESULT ← success</text>
  <text x="995" y="257" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">TEMP_REGISTER ← null</text>
  <text x="995" y="274" font-family="Monaco, monospace" font-size="11" fill="#333" text-anchor="middle">IR ← null (ready for next)</text>

  <!-- Legend -->
  <text x="20" y="360" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#666">Flow: Top row (left to right) → Bottom row (left to right)</text>
  <text x="20" y="380" font-family="system-ui, sans-serif" font-size="11" fill="#666">Decode → Execute → Read → Update Manifest → Recalculate → Complete</text>
</svg>
